<div *ngIf="kocList$ | async as list" class="table-toolbar">
    <app-add-koc #addKoc></app-add-koc>

    <button class="btn btn-primary" routerLink="/dashboard" routerLinkActive="active">
      ğŸ“Š Tá»•ng Quan
    </button>
    
    <button class="btn" (click)="bulkCrawl(list)">
      âš¡ Bulk Crawl
    </button>

    <input
      type="text"
      placeholder="Search"
      [(ngModel)]="searchText"
      (ngModelChange)="onSearchChange($event)"
    />

    <div class="dropdown-wrapper">
      <button class="btn" (click)="toggleFilter()">
        ğŸ¯ Filter
      </button>

      <app-filter-builder
        class="dropdown-content"
        *ngIf="showFilter"
        [filters]="filters"
        (filtersChange)="onFiltersChange($event)"
      ></app-filter-builder>
    </div>

    <div class="dropdown-wrapper">
      <button class="btn" (click)="toggleSort()">
        â†•ï¸ Sort
      </button>

      <app-sort-builder
        class="dropdown-content"
        *ngIf="isSortOpen"
        [sorts]="currentSorts"
        (sortsChange)="onSortChange($event)"
      ></app-sort-builder>
    </div>

    <input
      type="file"
      accept=".xlsx"
      (change)="onExcelUpload($event)"
    />

</div>
  
<div *ngIf="kocList$ | async as list" class="table-wrapper">
    <table class="koc-table">
    <thead>
      <tr>
        <th class="col-checkbox">
          <input
            type="checkbox"
            [checked]="selectAll"
            (change)="toggleSelectAll(list)"
          />
          <div (mousedown)="startResize($event)"></div>
        </th>
        <th >
          STT
          <div (mousedown)="startResize($event)"></div>
        </th>
        <th>
          TÃªn KÃªnh
          <div (mousedown)="startResize($event)"></div>
        </th>
        <th class="resizable">
          Link KÃªnh
          <div class="resize-handle" (mousedown)="startResize($event)"></div>
        </th>
        <th class="resizable">
          TrÃ¹ng
          <div class="resize-handle" (mousedown)="startResize($event)"></div>
        </th>
        <!-- CÃ¡c cá»™t khÃ¡c tÆ°Æ¡ng tá»±, thÃªm resizable + handle náº¿u muá»‘n resize -->
        <th class="resizable">NhÃ¢n ViÃªn<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Quáº£n LÃ½<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">NgÃ y TÃ¬m<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Cast<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Hoa Há»“ng<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Ghi ChÃº<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">NhÃ£n hÃ ng<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Sáº£n Pháº©m<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Tráº¡ng ThÃ¡i<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">NgÃ y Gá»­i Máº«u<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">NgÃ y Air Dá»± Kiáº¿n<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">NgÃ y Air Thá»±c Táº¿<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="col-video resizable">
          Link Video
          <div class="resize-handle" (mousedown)="startResize($event)"></div>
        </th>
        <th class="resizable">ID Video<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Data Retrieval Time<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">GMV<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Views<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Likes<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Comments<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Shares<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Saves<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th class="resizable">Is Ad<div class="resize-handle" (mousedown)="startResize($event)"></div></th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr
        *ngFor="let item of list; let i = index"
        [class.selected]="item.selected"
        (click)="toggleRow(item, list)"
      >
        <td class="col-checkbox sticky-col">
          <input
            type="checkbox"
            [(ngModel)]="item.selected"
            (click)="$event.stopPropagation()"
          />
        </td>

        <td class="col-stt sticky">{{ i + 1 }}</td>
        <td class="col-channel sticky-col">{{ item.channelName }}</td>
        <td>
          <a [href]="item.linkChannel" target="_blank" (click)="$event.stopPropagation()">
            {{ item.linkChannel }}
          </a>
        </td>

        <td>{{ item.isDuplicate ? 'TrÃ¹ng' : '' }}</td>
        <td>{{ item.staff }}</td>
        <td>{{ item.manager }}</td>
        <td>{{ item.dateFound | date:'dd-MM-yyyy' }}</td>
        <td>{{ item.cast }}</td>
        <td>{{ item.commission }}</td>
        <td>{{ item.note }}</td>
        <td>
          <button
            *ngFor="let l of item.labels"
            class="tag-btn"-col
            [style.background]="getTagColor(l)">
            {{ l }}
          </button>
        </td>
        <td>
          <button
            *ngFor="let p of item.products"
            class="tag-btn"
            [style.background]="getTagColor(p)">
            {{ p }}
          </button>
        </td>
        <td>{{ item.status }}</td>
        <td>{{ item.sampleSendDate | date:'dd-MM-yyyy' }}</td>
        <td>{{ item.expectedAirDate | date:'dd-MM-yyyy' }}</td>
        <td>{{ item.actualAirDate | date:'dd-MM-yyyy' }}</td>
        <td class="col-video" (dblclick)="showFullLink(item.videoLink); $event.stopPropagation()">
          <a [href]="item.videoLink" target="_blank" (click)="$event.stopPropagation()">
            {{ item.videoLink }}
          </a>
        </td>
        <td>{{ item.videoId }}</td>
        <td>{{ item.dataRetrievalTime }}</td>
        <td>{{ item.gmv }}</td>
        <td>{{ item.views | number }}</td>
        <td>{{ item.likes | number }}</td>
        <td>{{ item.comments | number }}</td>
        <td>{{ item.shares | number }}</td>
        <td>{{ item.saves }}</td>
        <td>{{ item.isAd ? 'Yes' : 'No' }}</td>
        <td>
          <button (click)="edit(item); $event.stopPropagation()">âœï¸</button>
          <button (click)="remove(item); $event.stopPropagation()">ğŸ—‘ï¸</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>