<button class="open-btn" (click)="openPopup()">‚ûï Th√™m KOC</button>

<div class="popup-container" *ngIf="isPopupOpen">
  <div class="popup-header">
    <h2>{{ form.value.channelName || 'B·∫£ng ghi kh√¥ng c√≥ ti√™u ƒë·ªÅ' }}</h2>
    <button class="close-btn" (click)="closePopup()">√ó</button>
  </div>

  <div class="popup-content">
    <form [formGroup]="form" (ngSubmit)="saveKoc()" class="form-grid">

      <!-- BASIC INFO -->
      <div class="field-row">
        <label>T√™n K√™nh</label>
        <input type="text" formControlName="channelName">
      </div>

      <div class="field-row">
        <label>Link K√™nh</label>
        <input type="text" formControlName="linkChannel">
      </div>

      <div class="field-row">
        <label>Ng√†y T√¨m</label>
        <input type="date" formControlName="dateFound">
      </div>

      <div class="field-row">
        <label>Tr√πng</label>
        <input type="checkbox" formControlName="isDuplicate">
      </div>

      <div class="field-row">
        <label>Nh√¢n Vi√™n</label>
        <input type="text" formControlName="staff" readonly>
      </div>

      <div class="field-row">
        <label>Qu·∫£n L√Ω</label>
        <input type="text" formControlName="manager" readonly>
      </div>

      <div class="field-row">
        <label>Cast</label>
        <input type="number" formControlName="cast">
      </div>

      <div class="field-row">
        <label>Hoa H·ªìng</label>
        <input type="text" formControlName="commission">
      </div>

      <div class="field-row">
        <label>Ghi Ch√∫</label>
        <input type="text" formControlName="note">
      </div>

      
      <!-- LABELS -->
      <!-- <div class="field-row">
        <label>Nh√£n h√†ng</label>
        <span class="tag green" *ngFor="let l of form.value.labels; let i=index">
          {{ l }} <span (click)="removeTag('labels', i)">√ó</span>
        </span>
        <select (change)="addSelectTag('labels', $event)">
          <option value="">Ch·ªçn nh√£n</option>
          <option *ngFor="let l of availableLabels" [value]="l">{{ l }}</option>
        </select>
      </div> -->
      <!-- LABELS -->
<div class="field-row">
  <label>Nh√£n h√†ng</label>

  <div class="select-wrapper">
    <div class="select-box" (click)="openLabelDropdown()">
      <span
        class="tag"
        *ngFor="let l of form.value.labels; let i = index"
        [ngClass]="getColor('products', l)"
      >
        {{ l }}
        <span class="remove" (click)="removeLabel(i); $event.stopPropagation()">√ó</span>
      </span>

      <span class="placeholder" *ngIf="!form.value.labels || form.value.labels.length === 0">
        Vui l√≤ng l·ª±a ch·ªçn
      </span>
    </div>

    <div class="dropdown" *ngIf="labelOpen">
      <span
        class="tag"
        *ngFor="let l of availableLabels"
        [ngClass]="getColor('products', l)"
        (click)="selectLabel(l)"
      >
        {{ l }}
      </span>
    </div>
  </div>
</div>


      <!-- PRODUCTS -->
      <!-- <div class="field-row">
        <label>S·∫£n ph·∫©m</label>

        <div class="product-box">

          <span
            class="product-tag"
            *ngFor="let p of form.value.products; let i = index"
            [ngClass]="getColor('products', p)"
          >
            {{ p }}
            <span class="remove" (click)="removeTag('products', i)">√ó</span>
          </span>

          <input
            type="text"
            placeholder="Ch·ªçn ho·∫∑c nh·∫≠p s·∫£n ph·∫©m"
            [(ngModel)]="productInput"
            [ngModelOptions]="{ standalone: true }"
            (input)="filterProducts()"
            (focus)="isOpen = true"
            (click)="isOpen = true"
            (keydown.enter)="onEnter()"
          />
        </div>

        <div class="product-dropdown" *ngIf="isOpen">
       
          <div
            class="dropdown-item"
            *ngFor="let p of filteredProducts"
            (click)="selectProduct(p, $event)"
            (click)="addProductToForm(p.name)"
          >
            {{ p.name }}
          </div>

          <div
            class="dropdown-add"
            *ngIf="filteredProducts.length === 0 && productInput"
            (click)="onEnter()"
          >
             Th√™m "{{ productInput }}"
          </div>
        </div>
      </div> -->
      <div class="field-row">
        <label>S·∫£n ph·∫©m</label>

        <div class="product-box" (click)="openDropdown()">
          <span
            class="product-tag"
            *ngFor="let p of form.value.products; let i = index"
            [ngClass]="getColor('products', p)"
          >
            {{ p }}
            <span class="remove" (click)="removeTag('products', i); $event.stopPropagation()">√ó</span>
          </span>
        </div>

        <div class="product-dropdown" *ngIf="isOpen">
          <input
            type="text"
            placeholder="Ch·ªçn ho·∫∑c nh·∫≠p s·∫£n ph·∫©m"
            [(ngModel)]="productInput"
            [ngModelOptions]="{ standalone: true }"
            (input)="filterProducts()"
            (keydown.enter)="onEnter(); $event.preventDefault()"
            #productInputEl
            [class.has-value]="productInput"
          />

          <div
            class="dropdown-item"
            *ngFor="let p of filteredProducts"
            (click)="selectProduct(p, $event)"
            (click)="addProductToForm(p.name)"
          >
            {{ p.name }}
          </div>

          <div
            class="dropdown-add"
            *ngIf="filteredProducts.length === 0 && productInput"
            (click)="onEnter()"
          >
            <span class="product-tag preview-tag">
              {{ productInput }}
              <span class="remove">√ó</span>
            </span>
          </div>
        </div>
      </div>
      
      <!-- STATUS -->
      <div class="field-row">
  <label>Tr·∫°ng th√°i</label>

  <div class="select-wrapper">
    <div class="select-box" (click)="openStatusDropdown()">
      <span
        class="tag"
        *ngIf="form.value.status"
        [ngClass]="getColor('statuses', form.value.status)"
      >
        {{ form.value.status }}
      </span>

      <span class="placeholder" *ngIf="!form.value.status">
        Ch·ªçn tr·∫°ng th√°i
      </span>
    </div>

    <div class="dropdown" *ngIf="statusOpen">
      <span
        class="tag"
        *ngFor="let s of availableStatuses"
        [ngClass]="getColor('statuses', s)"
        (click)="selectStatus(s)"
      >
        {{ s }}
      </span>
    </div>
  </div>
</div>
     

      <!-- TIMELINE -->
      <div class="field-row">
        <label>Ng√†y G·ª≠i M·∫´u</label>
        <input type="date" formControlName="sampleSendDate">
      </div>

      <div class="field-row">
        <label>Ng√†y Air D·ª± Ki·∫øn</label>
        <input type="date" formControlName="expectedAirDate">
      </div>

      <div class="field-row">
        <label>Ng√†y Air Th·ª±c T·∫ø</label>
        <input type="date" formControlName="actualAirDate">
      </div>

      <!-- TIKTOK -->
      <div class="field-row">
        <label>Link video TikTok</label>
        <input type="text" formControlName="videoLink">
        <button type="button" (click)="crawlTikTok()" [disabled]="isCrawling">
          {{ isCrawling ? 'ƒêang c√†o...' : 'C√†o d·ªØ li·ªáu' }}
        </button>
      </div>

      <div class="field-row">
        <label>ID Video TikTok</label>
        <input type="text" formControlName="videoId" readonly>
      </div>

      <div class="field-row">
        <label>GMV</label>
        <input type="number" formControlName="gmv" readonly>
      </div>

      <div class="field-row">
        <label>View</label>
        <input type="number" formControlName="views" readonly>
      </div>

      <div class="field-row">
        <label>Like</label>
        <input type="number" formControlName="likes" readonly>
      </div>

      <div class="field-row">
        <label>Comment</label>
        <input type="number" formControlName="comments" readonly>
      </div>

      <div class="field-row">
        <label>Share</label>
        <input type="number" formControlName="shares" readonly>
      </div>

      <div class="field-row">
        <label>Save</label>
        <input type="number" formControlName="saves" readonly>
      </div>

      <div class="field-row">
        <label>Title</label>
        <input type="text" formControlName="title" readonly>
      </div>

      <div class="field-row">
        <label>Data Retrieval Time</label>
        <input type="text" formControlName="dataRetrievalTime" readonly>
      </div>

      <div class="form-actions">
        <button type="submit">üíæ L∆∞u</button>
        <button type="button" (click)="closePopup()">H·ªßy</button>
      </div>

    </form>
  </div>
</div>

